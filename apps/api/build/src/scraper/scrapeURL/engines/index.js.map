{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../../src/scraper/scrapeURL/engines/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { ScrapeActionContent } from \"../../../lib/entities\";\nimport { Meta } from \"..\";\nimport { scrapeDOCX } from \"./docx\";\nimport {\n  scrapeURLWithFireEngineChromeCDP,\n  scrapeURLWithFireEnginePlaywright,\n  scrapeURLWithFireEngineTLSClient,\n} from \"./fire-engine\";\nimport { scrapePDF } from \"./pdf\";\nimport { scrapeURLWithFetch } from \"./fetch\";\nimport { scrapeURLWithPlaywright } from \"./playwright\";\nimport { scrapeURLWithIndex } from \"./index/index\";\nimport { useIndex } from \"../../../services\";\n\nexport type Engine =\n  | \"fire-engine;chrome-cdp\"\n  | \"fire-engine(retry);chrome-cdp\"\n  | \"fire-engine;chrome-cdp;stealth\"\n  | \"fire-engine(retry);chrome-cdp;stealth\"\n  | \"fire-engine;playwright\"\n  | \"fire-engine;playwright;stealth\"\n  | \"fire-engine;tlsclient\"\n  | \"fire-engine;tlsclient;stealth\"\n  | \"playwright\"\n  | \"fetch\"\n  | \"pdf\"\n  | \"docx\"\n  | \"index\"\n  | \"index;documents\";\n\nconst useFireEngine =\n  process.env.FIRE_ENGINE_BETA_URL !== \"\" &&\n  process.env.FIRE_ENGINE_BETA_URL !== undefined;\nconst usePlaywright =\n  process.env.PLAYWRIGHT_MICROSERVICE_URL !== \"\" &&\n  process.env.PLAYWRIGHT_MICROSERVICE_URL !== undefined;\n\nexport const engines: Engine[] = [\n  ...(useIndex ? [\"index\" as const, \"index;documents\" as const] : []),\n  ...(useFireEngine\n    ? [\n        \"fire-engine;chrome-cdp\" as const,\n        \"fire-engine;chrome-cdp;stealth\" as const,\n        \"fire-engine(retry);chrome-cdp\" as const,\n        \"fire-engine(retry);chrome-cdp;stealth\" as const,\n        \"fire-engine;playwright\" as const,\n        \"fire-engine;playwright;stealth\" as const,\n        \"fire-engine;tlsclient\" as const,\n        \"fire-engine;tlsclient;stealth\" as const,\n      ]\n    : []),\n  ...(usePlaywright ? [\"playwright\" as const] : []),\n  \"fetch\",\n  \"pdf\",\n  \"docx\",\n];\n\nexport const featureFlags = [\n  \"actions\",\n  \"waitFor\",\n  \"screenshot\",\n  \"screenshot@fullScreen\",\n  \"pdf\",\n  \"docx\",\n  \"atsv\",\n  \"location\",\n  \"mobile\",\n  \"skipTlsVerification\",\n  \"useFastMode\",\n  \"stealthProxy\",\n  \"disableAdblock\",\n] as const;\n\nexport type FeatureFlag = (typeof featureFlags)[number];\n\nexport const featureFlagOptions: {\n  [F in FeatureFlag]: {\n    priority: number;\n  };\n} = {\n  actions: { priority: 20 },\n  waitFor: { priority: 1 },\n  screenshot: { priority: 10 },\n  \"screenshot@fullScreen\": { priority: 10 },\n  pdf: { priority: 100 },\n  docx: { priority: 100 },\n  atsv: { priority: 90 }, // NOTE: should atsv force to tlsclient? adjust priority if not\n  useFastMode: { priority: 90 },\n  location: { priority: 10 },\n  mobile: { priority: 10 },\n  skipTlsVerification: { priority: 10 },\n  stealthProxy: { priority: 20 },\n  disableAdblock: { priority: 10 },\n} as const;\n\nexport type EngineScrapeResult = {\n  url: string;\n\n  html: string;\n  markdown?: string;\n  statusCode: number;\n  error?: string;\n\n  screenshot?: string;\n  actions?: {\n    screenshots: string[];\n    scrapes: ScrapeActionContent[];\n    javascriptReturns: {\n      type: string;\n      value: unknown\n    }[];\n    pdfs: string[];\n  };\n\n  numPages?: number;\n\n  cacheInfo?: {\n    created_at: Date;\n  };\n  \n  contentType?: string;\n\n  proxyUsed: \"basic\" | \"stealth\";\n};\n\nconst engineHandlers: {\n  [E in Engine]: (\n    meta: Meta,\n    timeToRun: number | undefined,\n  ) => Promise<EngineScrapeResult>;\n} = {\n  index: scrapeURLWithIndex,\n  \"index;documents\": scrapeURLWithIndex,\n  \"fire-engine;chrome-cdp\": scrapeURLWithFireEngineChromeCDP,\n  \"fire-engine(retry);chrome-cdp\": scrapeURLWithFireEngineChromeCDP,\n  \"fire-engine;chrome-cdp;stealth\": scrapeURLWithFireEngineChromeCDP,\n  \"fire-engine(retry);chrome-cdp;stealth\": scrapeURLWithFireEngineChromeCDP,\n  \"fire-engine;playwright\": scrapeURLWithFireEnginePlaywright,\n  \"fire-engine;playwright;stealth\": scrapeURLWithFireEnginePlaywright,\n  \"fire-engine;tlsclient\": scrapeURLWithFireEngineTLSClient,\n  \"fire-engine;tlsclient;stealth\": scrapeURLWithFireEngineTLSClient,\n  playwright: scrapeURLWithPlaywright,\n  fetch: scrapeURLWithFetch,\n  pdf: scrapePDF,\n  docx: scrapeDOCX,\n};\n\nexport const engineOptions: {\n  [E in Engine]: {\n    // A list of feature flags the engine supports.\n    features: { [F in FeatureFlag]: boolean };\n\n    // This defines the order of engines in general. The engine with the highest quality will be used the most.\n    // Negative quality numbers are reserved for specialty engines, e.g. PDF, DOCX, stealth proxies\n    quality: number;\n  };\n} = {\n  index: {\n    features: {\n      actions: false,\n      waitFor: true,\n      screenshot: true,\n      \"screenshot@fullScreen\": true,\n      pdf: false,\n      docx: false,\n      atsv: false,\n      mobile: true,\n      location: true,\n      skipTlsVerification: true,\n      useFastMode: true,\n      stealthProxy: false,\n      disableAdblock: true,\n    },\n    quality: 1000, // index should always be tried first\n  },\n  \"fire-engine;chrome-cdp\": {\n    features: {\n      actions: true,\n      waitFor: true, // through actions transform\n      screenshot: true, // through actions transform\n      \"screenshot@fullScreen\": true, // through actions transform\n      pdf: false,\n      docx: false,\n      atsv: false,\n      location: true,\n      mobile: true,\n      skipTlsVerification: true,\n      useFastMode: false,\n      stealthProxy: false,\n      disableAdblock: false,\n    },\n    quality: 50,\n  },\n  \"fire-engine(retry);chrome-cdp\": {\n    features: {\n      actions: true,\n      waitFor: true, // through actions transform\n      screenshot: true, // through actions transform\n      \"screenshot@fullScreen\": true, // through actions transform\n      pdf: false,\n      docx: false,\n      atsv: false,\n      location: true,\n      mobile: true,\n      skipTlsVerification: true,\n      useFastMode: false,\n      stealthProxy: false,\n      disableAdblock: false,\n    },\n    quality: 45,\n  },\n  \"index;documents\": {\n    features: {\n      actions: false,\n      waitFor: true,\n      screenshot: true,\n      \"screenshot@fullScreen\": true,\n      pdf: true,\n      docx: true,\n      atsv: false,\n      location: true,\n      mobile: true,\n      skipTlsVerification: true,\n      useFastMode: true,\n      stealthProxy: false,\n      disableAdblock: false,\n    },\n    quality: -1,\n  },\n  \"fire-engine;chrome-cdp;stealth\": {\n    features: {\n      actions: true,\n      waitFor: true, // through actions transform\n      screenshot: true, // through actions transform\n      \"screenshot@fullScreen\": true, // through actions transform\n      pdf: false,\n      docx: false,\n      atsv: false,\n      location: true,\n      mobile: true,\n      skipTlsVerification: true,\n      useFastMode: false,\n      stealthProxy: true,\n      disableAdblock: false,\n    },\n    quality: -2,\n  },\n  \"fire-engine(retry);chrome-cdp;stealth\": {\n    features: {\n      actions: true,\n      waitFor: true, // through actions transform\n      screenshot: true, // through actions transform\n      \"screenshot@fullScreen\": true, // through actions transform\n      pdf: false,\n      docx: false,\n      atsv: false,\n      location: true,\n      mobile: true,\n      skipTlsVerification: true,\n      useFastMode: false,\n      stealthProxy: true,\n      disableAdblock: false,\n    },\n    quality: -5,\n  },\n  \"fire-engine;playwright\": {\n    features: {\n      actions: false,\n      waitFor: true,\n      screenshot: true,\n      \"screenshot@fullScreen\": true,\n      pdf: false,\n      docx: false,\n      atsv: false,\n      location: false,\n      mobile: false,\n      skipTlsVerification: false,\n      useFastMode: false,\n      stealthProxy: false,\n      disableAdblock: true,\n    },\n    quality: 40,\n  },\n  \"fire-engine;playwright;stealth\": {\n    features: {\n      actions: false,\n      waitFor: true,\n      screenshot: true,\n      \"screenshot@fullScreen\": true,\n      pdf: false,\n      docx: false,\n      atsv: false,\n      location: false,\n      mobile: false,\n      skipTlsVerification: false,\n      useFastMode: false,\n      stealthProxy: true,\n      disableAdblock: true,\n    },\n    quality: -10,\n  },\n  playwright: {\n    features: {\n      actions: false,\n      waitFor: true,\n      screenshot: false,\n      \"screenshot@fullScreen\": false,\n      pdf: false,\n      docx: false,\n      atsv: false,\n      location: false,\n      mobile: false,\n      skipTlsVerification: false,\n      useFastMode: false,\n      stealthProxy: false,\n      disableAdblock: false,\n    },\n    quality: 20,\n  },\n  \"fire-engine;tlsclient\": {\n    features: {\n      actions: false,\n      waitFor: false,\n      screenshot: false,\n      \"screenshot@fullScreen\": false,\n      pdf: false,\n      docx: false,\n      atsv: true,\n      location: true,\n      mobile: false,\n      skipTlsVerification: false,\n      useFastMode: true,\n      stealthProxy: false,\n      disableAdblock: false,\n    },\n    quality: 10,\n  },\n  \"fire-engine;tlsclient;stealth\": {\n    features: {\n      actions: false,\n      waitFor: false,\n      screenshot: false,\n      \"screenshot@fullScreen\": false,\n      pdf: false,\n      docx: false,\n      atsv: true,\n      location: true,\n      mobile: false,\n      skipTlsVerification: false,\n      useFastMode: true,\n      stealthProxy: true,\n      disableAdblock: false,\n    },\n    quality: -15,\n  },\n  fetch: {\n    features: {\n      actions: false,\n      waitFor: false,\n      screenshot: false,\n      \"screenshot@fullScreen\": false,\n      pdf: false,\n      docx: false,\n      atsv: false,\n      location: false,\n      mobile: false,\n      skipTlsVerification: false,\n      useFastMode: true,\n      stealthProxy: false,\n      disableAdblock: false,\n    },\n    quality: 5,\n  },\n  pdf: {\n    features: {\n      actions: false,\n      waitFor: false,\n      screenshot: false,\n      \"screenshot@fullScreen\": false,\n      pdf: true,\n      docx: false,\n      atsv: false,\n      location: false,\n      mobile: false,\n      skipTlsVerification: false,\n      useFastMode: true,\n      stealthProxy: true, // kinda...\n      disableAdblock: true,\n    },\n    quality: -20,\n  },\n  docx: {\n    features: {\n      actions: false,\n      waitFor: false,\n      screenshot: false,\n      \"screenshot@fullScreen\": false,\n      pdf: false,\n      docx: true,\n      atsv: false,\n      location: false,\n      mobile: false,\n      skipTlsVerification: false,\n      useFastMode: true,\n      stealthProxy: true, // kinda...\n      disableAdblock: true,\n    },\n    quality: -20,\n  },\n};\n\nexport function buildFallbackList(meta: Meta): {\n  engine: Engine;\n  unsupportedFeatures: Set<FeatureFlag>;\n}[] {\n  const _engines: Engine[] = [\n    ...engines,\n    \n    // enable fire-engine in self-hosted testing environment when mocks are supplied\n    ...((!useFireEngine && meta.mock !== null) ? [\"fire-engine;chrome-cdp\", \"fire-engine(retry);chrome-cdp\", \"fire-engine;chrome-cdp;stealth\", \"fire-engine(retry);chrome-cdp;stealth\", \"fire-engine;playwright\", \"fire-engine;tlsclient\", \"fire-engine;playwright;stealth\", \"fire-engine;tlsclient;stealth\"] as Engine[] : [])\n  ];\n\n  const shouldUseIndex =\n    useIndex\n    && process.env.FIRECRAWL_INDEX_WRITE_ONLY !== \"true\"\n    && !meta.options.formats.includes(\"changeTracking\")\n    && meta.options.maxAge !== 0\n    && (\n      meta.options.headers === undefined\n      || Object.keys(meta.options.headers).length === 0\n    )\n    && (\n      meta.options.actions === undefined\n      || meta.options.actions.length === 0\n    )\n    && meta.options.proxy !== \"stealth\";\n  \n  if (!shouldUseIndex) {\n    const indexIndex = _engines.indexOf(\"index\");\n    if (indexIndex !== -1) {\n      _engines.splice(indexIndex, 1);\n    }\n    const indexDocumentsIndex = _engines.indexOf(\"index;documents\");\n    if (indexDocumentsIndex !== -1) {\n      _engines.splice(indexDocumentsIndex, 1);\n    }\n  }\n  \n  const prioritySum = [...meta.featureFlags].reduce(\n    (a, x) => a + featureFlagOptions[x].priority,\n    0,\n  );\n  const priorityThreshold = Math.floor(prioritySum / 2);\n  let selectedEngines: {\n    engine: Engine;\n    supportScore: number;\n    unsupportedFeatures: Set<FeatureFlag>;\n  }[] = [];\n\n  const currentEngines =\n    meta.internalOptions.forceEngine !== undefined\n      ? (Array.isArray(meta.internalOptions.forceEngine) ? meta.internalOptions.forceEngine : [meta.internalOptions.forceEngine])\n      : _engines;\n\n  for (const engine of currentEngines) {\n    const supportedFlags = new Set([\n      ...Object.entries(engineOptions[engine].features)\n        .filter(\n          ([k, v]) => meta.featureFlags.has(k as FeatureFlag) && v === true,\n        )\n        .map(([k, _]) => k),\n    ]);\n    const supportScore = [...supportedFlags].reduce(\n      (a, x) => a + featureFlagOptions[x].priority,\n      0,\n    );\n\n    const unsupportedFeatures = new Set([...meta.featureFlags]);\n    for (const flag of meta.featureFlags) {\n      if (supportedFlags.has(flag)) {\n        unsupportedFeatures.delete(flag);\n      }\n    }\n\n    if (supportScore >= priorityThreshold) {\n      selectedEngines.push({ engine, supportScore, unsupportedFeatures });\n    }\n  }\n\n  if (selectedEngines.some((x) => engineOptions[x.engine].quality > 0)) {\n    selectedEngines = selectedEngines.filter(\n      (x) => engineOptions[x.engine].quality > 0,\n    );\n  }\n\n  if (meta.internalOptions.forceEngine === undefined) { // retain force engine order\n    selectedEngines.sort(\n      (a, b) =>\n        b.supportScore - a.supportScore ||\n        engineOptions[b.engine].quality - engineOptions[a.engine].quality,\n    );\n  }\n\n  meta.logger.info(\"Selected engines\", {\n    selectedEngines,\n  });\n\n  return selectedEngines;\n}\n\nexport async function scrapeURLWithEngine(\n  meta: Meta,\n  engine: Engine,\n  timeToRun: number | undefined,\n): Promise<EngineScrapeResult> {\n  const fn = engineHandlers[engine];\n  const logger = meta.logger.child({\n    method: fn.name ?? \"scrapeURLWithEngine\",\n    engine,\n  });\n  const _meta = {\n    ...meta,\n    logger,\n  };\n\n  return await fn(_meta, timeToRun);\n}\n"]}