{"version":3,"file":"uploadScreenshot.js","sourceRoot":"","sources":["../../../../../src/scraper/scrapeURL/transformers/uploadScreenshot.ts"],"names":[],"mappings":";AAAA,oEAAoE;AACpE,gCAAgC;;AAMhC,4CA0BC;AA9BD,yDAA8D;AAI9D,SAAgB,gBAAgB,CAAC,IAAU,EAAE,QAAkB;IAC7D,IACE,OAAO,CAAC,GAAG,CAAC,qBAAqB,KAAK,MAAM;QAC5C,QAAQ,CAAC,UAAU,KAAK,SAAS;QACjC,QAAQ,CAAC,UAAU,CAAC,UAAU,CAAC,OAAO,CAAC,EACvC,CAAC;QACD,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,qCAAqC,CAAC,CAAC;QAEzD,MAAM,QAAQ,GAAG,cAAc,MAAM,CAAC,UAAU,EAAE,MAAM,CAAC;QAEzD,2BAAgB,CAAC,OAAO;aACrB,IAAI,CAAC,OAAO,CAAC;aACb,MAAM,CACL,QAAQ,EACR,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,QAAQ,CAAC,EACxD;YACE,YAAY,EAAE,MAAM;YACpB,MAAM,EAAE,KAAK;YACb,WAAW,EAAE,QAAQ,CAAC,UAAU,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;SAC7D,CACF,CAAC;QAEJ,QAAQ,CAAC,UAAU,GAAG,gEAAgE,kBAAkB,CAAC,QAAQ,CAAC,EAAE,CAAC;IACvH,CAAC;IAED,OAAO,QAAQ,CAAC;AAClB,CAAC","sourcesContent":["// This file is an exception to the \"no supabase in scrapeURL\" rule,\n// and it makes me sad. - mogery\n\nimport { supabase_service } from \"../../../services/supabase\";\nimport { Meta } from \"..\";\nimport { Document } from \"../../../controllers/v1/types\";\n\nexport function uploadScreenshot(meta: Meta, document: Document): Document {\n  if (\n    process.env.USE_DB_AUTHENTICATION === \"true\" &&\n    document.screenshot !== undefined &&\n    document.screenshot.startsWith(\"data:\")\n  ) {\n    meta.logger.debug(\"Uploading screenshot to Supabase...\");\n\n    const fileName = `screenshot-${crypto.randomUUID()}.png`;\n\n    supabase_service.storage\n      .from(\"media\")\n      .upload(\n        fileName,\n        Buffer.from(document.screenshot.split(\",\")[1], \"base64\"),\n        {\n          cacheControl: \"3600\",\n          upsert: false,\n          contentType: document.screenshot.split(\":\")[1].split(\";\")[0],\n        },\n      );\n\n    document.screenshot = `https://service.firecrawl.dev/storage/v1/object/public/media/${encodeURIComponent(fileName)}`;\n  }\n\n  return document;\n}\n"]}