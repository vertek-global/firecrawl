{"version":3,"file":"scrape-billing.js","sourceRoot":"","sources":["../../../src/lib/scrape-billing.ts"],"names":[],"mappings":";;AAOA,gEAkCC;AArCD,MAAM,iBAAiB,GAAG,CAAC,CAAC;AAC5B,MAAM,qBAAqB,GAAG,CAAC,CAAC;AAEzB,KAAK,UAAU,0BAA0B,CAAC,OAAsB,EAAE,eAAgC,EAAE,QAAyB,EAAE,YAA0B,EAAE,KAAgB;IAC9K,IAAI,QAAQ,KAAK,IAAI,EAAE,CAAC;QACpB,2CAA2C;QAC3C,IAAI,iBAAiB,GAAG,CAAC,CAAC;QAE1B,IAAI,OAAO,CAAC,KAAK,EAAE,KAAK,EAAE,WAAW,EAAE,KAAK,QAAQ,IAAI,OAAO,CAAC,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,WAAW,EAAE,KAAK,QAAQ,IAAI,OAAO,CAAC,WAAW,EAAE,KAAK,EAAE,KAAK,EAAE,WAAW,EAAE,KAAK,QAAQ,EAAE,CAAC;YACjL,iBAAiB,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,YAAY,CAAC,MAAM,EAAE,CAAC,SAAS,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC;QACjF,CAAC;QAED,OAAO,iBAAiB,CAAC;IAC7B,CAAC;IAED,IAAI,iBAAiB,GAAG,CAAC,CAAC,CAAC,iCAAiC;IAC5D,IAAI,CAAC,OAAO,CAAC,OAAO,IAAI,OAAO,CAAC,OAAO,EAAE,QAAQ,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,QAAQ,CAAC,gBAAgB,CAAC,IAAI,OAAO,CAAC,qBAAqB,EAAE,KAAK,EAAE,QAAQ,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC;QACvK,iBAAiB,GAAG,CAAC,CAAC;IAC1B,CAAC;IAED,IAAI,OAAO,CAAC,KAAK,EAAE,KAAK,EAAE,WAAW,EAAE,KAAK,QAAQ,IAAI,OAAO,CAAC,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,WAAW,EAAE,KAAK,QAAQ,IAAI,OAAO,CAAC,WAAW,EAAE,KAAK,EAAE,KAAK,EAAE,WAAW,EAAE,KAAK,QAAQ,EAAE,CAAC;QACjL,iBAAiB,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,YAAY,CAAC,MAAM,EAAE,CAAC,SAAS,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC;IACjF,CAAC;IAED,IAAI,eAAe,CAAC,iBAAiB,EAAE,CAAC;QACpC,iBAAiB,IAAI,CAAC,KAAK,EAAE,OAAO,IAAI,CAAC,CAAC,CAAC;IAC/C,CAAC;IAED,IAAI,QAAQ,CAAC,QAAQ,CAAC,QAAQ,KAAK,SAAS,IAAI,QAAQ,CAAC,QAAQ,CAAC,QAAQ,GAAG,CAAC,EAAE,CAAC;QAC7E,iBAAiB,IAAI,iBAAiB,GAAG,CAAC,QAAQ,CAAC,QAAQ,CAAC,QAAQ,GAAG,CAAC,CAAC,CAAC;IAC9E,CAAC;IAED,IAAI,QAAQ,EAAE,QAAQ,EAAE,SAAS,KAAK,SAAS,EAAE,CAAC;QAC9C,iBAAiB,IAAI,qBAAqB,CAAC;IAC/C,CAAC;IAED,OAAO,iBAAiB,CAAC;AAC7B,CAAC","sourcesContent":["import { InternalOptions } from \"src/scraper/scrapeURL\";\nimport { Document, ScrapeOptions, TeamFlags } from \"../controllers/v1/types\";\nimport { CostTracking } from \"./extract/extraction-service\";\n\nconst creditsPerPDFPage = 1;\nconst stealthProxyCostBonus = 4;\n\nexport async function calculateCreditsToBeBilled(options: ScrapeOptions, internalOptions: InternalOptions, document: Document | null, costTracking: CostTracking, flags: TeamFlags) {\n    if (document === null) {\n        // Failure -- check cost tracking if FIRE-1\n        let creditsToBeBilled = 0;\n\n        if (options.agent?.model?.toLowerCase() === \"fire-1\" || options.extract?.agent?.model?.toLowerCase() === \"fire-1\" || options.jsonOptions?.agent?.model?.toLowerCase() === \"fire-1\") {\n            creditsToBeBilled = Math.ceil((costTracking.toJSON().totalCost ?? 1) * 1800);\n        } \n    \n        return creditsToBeBilled;\n    }\n\n    let creditsToBeBilled = 1; // Assuming 1 credit per document\n    if ((options.extract && options.formats?.includes(\"extract\")) || (options.formats?.includes(\"changeTracking\") && options.changeTrackingOptions?.modes?.includes(\"json\"))) {\n        creditsToBeBilled = 5;\n    }\n\n    if (options.agent?.model?.toLowerCase() === \"fire-1\" || options.extract?.agent?.model?.toLowerCase() === \"fire-1\" || options.jsonOptions?.agent?.model?.toLowerCase() === \"fire-1\") {\n        creditsToBeBilled = Math.ceil((costTracking.toJSON().totalCost ?? 1) * 1800);\n    } \n\n    if (internalOptions.zeroDataRetention) {\n        creditsToBeBilled += (flags?.zdrCost ?? 1);\n    }\n    \n    if (document.metadata.numPages !== undefined && document.metadata.numPages > 1) {\n        creditsToBeBilled += creditsPerPDFPage * (document.metadata.numPages - 1);\n    }\n\n    if (document?.metadata?.proxyUsed === \"stealth\") {\n        creditsToBeBilled += stealthProxyCostBonus;\n    }\n\n    return creditsToBeBilled;\n}"]}