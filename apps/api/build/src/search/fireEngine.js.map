{"version":3,"file":"fireEngine.js","sourceRoot":"","sources":["../../../src/search/fireEngine.ts"],"names":[],"mappings":"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","sourcesContent":["import dotenv from \"dotenv\";\nimport { SearchResult } from \"../../src/lib/entities\";\nimport * as Sentry from \"@sentry/node\";\nimport { logger } from \"../lib/logger\";\n\ndotenv.config();\n\n\nexport async function fire_engine_search(\n  q: string,\n  options: {\n    tbs?: string;\n    filter?: string;\n    lang?: string;\n    country?: string;\n    location?: string;\n    numResults: number;\n    page?: number;\n  },\n  abort?: AbortSignal,\n): Promise<SearchResult[]> {\n  try {\n    let data = JSON.stringify({\n      query: q,\n      lang: options.lang,\n      country: options.country,\n      location: options.location,\n      tbs: options.tbs,\n      numResults: options.numResults,\n      page: options.page ?? 1,\n    });\n\n    if (!process.env.FIRE_ENGINE_BETA_URL) {\n      return [];\n    }\n\n    const response = await fetch(`${process.env.FIRE_ENGINE_BETA_URL}/search`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"X-Disable-Cache\": \"true\",\n      },\n      body: data,\n      signal: abort,\n    });\n\n    if (response.ok) {\n      const responseData = await response.json();\n      return responseData;\n    } else {\n      return [];\n    }\n  } catch (error) {\n    logger.error(error);\n    Sentry.captureException(error);\n    return [];\n  }\n}\n\nexport async function fireEngineMap(\n  q: string,\n  options: {\n    tbs?: string;\n    filter?: string;\n    lang?: string;\n    country?: string;\n    location?: string;\n    numResults: number;\n    page?: number;\n  },\n  abort?: AbortSignal,\n): Promise<SearchResult[]> {\n  try {\n    let data = JSON.stringify({\n      query: q,\n      lang: options.lang,\n      country: options.country,\n      location: options.location,\n      tbs: options.tbs,\n      numResults: options.numResults,\n      page: options.page ?? 1,\n    });\n\n    if (!process.env.FIRE_ENGINE_BETA_URL) {\n      logger.warn(\"(v1/map Beta) Results might differ from cloud offering currently.\");\n      return [];\n    }\n\n    const response = await fetch(`${process.env.FIRE_ENGINE_BETA_URL}/map`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"X-Disable-Cache\": \"true\",\n      },\n      body: data,\n      signal: abort,\n    });\n\n    if (response.ok) {\n      const responseData = await response.json();\n      return responseData;\n    } else {\n      return [];\n    }\n  } catch (error) {\n    logger.error(error);\n    Sentry.captureException(error);\n    return [];\n  }\n}\n"]}