{"version":3,"file":"keyAuth.js","sourceRoot":"","sources":["../../../../src/controllers/v0/keyAuth.ts"],"names":[],"mappings":";;;AAGA,kCAA2C;AAC3C,uDAAmE;AACnE,6CAA0C;AAEnC,MAAM,iBAAiB,GAAG,KAAK,EAAE,GAAY,EAAE,GAAa,EAAE,EAAE;IACrE,IAAI,CAAC;QACH,uDAAuD;QACvD,MAAM,IAAI,GAAG,MAAM,IAAA,uBAAgB,EAAC,GAAG,EAAE,GAAG,CAAC,CAAC;QAC9C,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;YAClB,OAAO,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC;QAC7D,CAAC;QAED,IAAI,IAAI,CAAC,KAAK,EAAE,KAAK,EAAE,QAAQ,EAAE,CAAC;YAChC,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,4HAA4H,EAAE,CAAC,CAAC;QACvK,CAAC;QAED,4BAAoB,CAAC,IAAI,CAAC,gBAAgB,EAAE,IAAI,CAAC,OAAO,CAAC;aACtD,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC,eAAM,CAAC,KAAK,CAAC,sCAAsC,EAAE,EAAE,KAAK,EAAE,OAAO,EAAE,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;QAE1G,mCAAmC;QACnC,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;IACjD,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;IACxD,CAAC;AACH,CAAC,CAAC;AApBW,QAAA,iBAAiB,qBAoB5B","sourcesContent":["import { AuthResponse, RateLimiterMode } from \"../../types\";\n\nimport { Request, Response } from \"express\";\nimport { authenticateUser } from \"../auth\";\nimport { redisEvictConnection } from \"../../../src/services/redis\";\nimport { logger } from \"../../lib/logger\";\n\nexport const keyAuthController = async (req: Request, res: Response) => {\n  try {\n    // make sure to authenticate user first, Bearer <token>\n    const auth = await authenticateUser(req, res);\n    if (!auth.success) {\n      return res.status(auth.status).json({ error: auth.error });\n    }\n\n    if (auth.chunk?.flags?.forceZDR) {\n      return res.status(400).json({ error: \"Your team has zero data retention enabled. This is not supported on the v0 API. Please update your code to use the v1 API.\" });\n    }\n\n    redisEvictConnection.sadd(\"teams_using_v0\", auth.team_id)\n      .catch(error => logger.error(\"Failed to add team to teams_using_v0\", { error, team_id: auth.team_id }));\n\n    // if success, return success: true\n    return res.status(200).json({ success: true });\n  } catch (error) {\n    return res.status(500).json({ error: error.message });\n  }\n};\n"]}